<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Inventory | MOBILINK MOTORS</title>

  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f7f7f7;
      padding: 40px;
      margin: 0;
      color: #222;
    }

    header {
      display: flex;
      flex-direction: column;
      gap: 12px;
      margin-bottom: 18px;
    }

    header h1 {
      margin: 0;
      font-size: 28px;
      color: #111;
    }

    .controls {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      align-items: center;
    }

    .controls input[type="search"],
    .controls select {
      padding: 10px 12px;
      border-radius: 8px;
      border: 1px solid #ddd;
      background: #fff;
      font-size: 14px;
    }

    #inventory {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
      gap: 20px;
      margin-top: 18px;
    }

    #inventory .card {
      background: #ffffff;
      padding: 16px;
      border-radius: 8px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.08);
      display: flex;
      gap: 12px;
      align-items: center;
    }

    #inventory .thumb {
      width: 120px;
      height: 80px;
      background: linear-gradient(135deg,#eee,#ddd);
      border-radius: 6px;
      flex-shrink: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #777;
      font-size: 12px;
      overflow: hidden;
    }

    #inventory .meta {
      flex: 1 1 auto;
    }

    .meta h3 {
      margin: 0 0 6px 0;
      font-size: 16px;
    }

    .meta .specs {
      font-size: 13px;
      color: #555;
      margin-bottom: 8px;
    }

    .meta .price {
      font-weight: 700;
      color: #0a6;
    }

    .badge {
      padding: 6px 8px;
      border-radius: 999px;
      font-size: 12px;
      background: #eef7ff;
      color: #036;
      display: inline-block;
    }

    @media (max-width: 520px) {
      body { padding: 18px; }
      .controls { flex-direction: column; align-items: stretch; }
      header h1 { font-size: 20px; }
      #inventory .thumb { width: 100px; height: 66px; }
    }
  </style>
</head>
<body>
  <header>
    <h1>Inventory</h1>
    <div class="controls">
      <input id="search" type="search" placeholder="Search by make, model, or year">
      <select id="filterStock">
        <option value="all">All stock</option>
        <option value="in">In stock</option>
        <option value="out">Out of stock</option>
      </select>
      <select id="sortBy">
        <option value="newest">Newest</option>
        <option value="priceLow">Price: Low → High</option>
        <option value="priceHigh">Price: High → Low</option>
      </select>
    </div>
  </header>

  <main>
    <section id="inventory" aria-live="polite">
      <!-- cards rendered by JS -->
    </section>
  </main>

  <script>
    // Apps Script endpoint (provided). Remove trailing semicolon if present.
    const API_URL = "https://script.google.com/macros/s/AKfycbzd1_RuR2SkoIClSCtr5rF4M7xZGGWEGyssKxULAnceHlx5McREPzKbTogzLakeViG4/exec";

    // Local sample fallback
    let fetch = [
      { id: 1, make: 'Toyota', model: 'Corolla', year: 2020, price: 15900, stock: true, img: '' },
      { id: 2, make: 'Honda', model: 'Civic', year: 2019, price: 14950, stock: true, img: '' },
      { id: 3, make: 'Ford', model: 'F-150', year: 2021, price: 28900, stock: false, img: '' },
      { id: 4, make: 'BMW', model: 'X3', year: 2018, price: 21900, stock: true, img: '' },
      { id: 5, make: 'Tesla', model: 'Model 3', year: 2022, price: 35900, stock: false, img: '' }
    ];

    const inventoryEl = document.getElementById('inventory');
    const searchEl = document.getElementById('search');
    const filterStockEl = document.getElementById('filterStock');
    const sortByEl = document.getElementById('sortBy');

    function formatPrice(n) {
      return n.toLocaleString(undefined, { style: 'currency', currency: 'USD', maximumFractionDigits: 0 });
    }

    function showLoading() {
      inventoryEl.innerHTML = '<div style="padding:20px;background:#fff;border-radius:8px">Loading inventory...</div>';
    }

    function showError(msg) {
      inventoryEl.innerHTML = `<div style="padding:20px;background:#fff;border-radius:8px;color:#900">${msg}</div>`;
    }

    function render(items) {
      inventoryEl.innerHTML = '';
      if (!items || !items.length) {
        inventoryEl.innerHTML = '<div style="padding:20px;background:#fff;border-radius:8px">No vehicles found.</div>';
        return;
      }

      for (const v of items) {
        const card = document.createElement('div');
        card.className = 'card';

        const thumb = document.createElement('div');
        thumb.className = 'thumb';
        if (v.img) {
          const img = document.createElement('img');
          img.src = v.img;
          img.alt = `${v.make} ${v.model}`;
          img.style.width = '100%';
          img.style.height = '100%';
          img.style.objectFit = 'cover';
          thumb.appendChild(img);
        } else {
          thumb.textContent = `${v.make} ${v.model}`;
        }

        const meta = document.createElement('div');
        meta.className = 'meta';

        const title = document.createElement('h3');
        title.textContent = `${v.year} ${v.make} ${v.model}`;

        const specs = document.createElement('div');
        specs.className = 'specs';
        specs.textContent = `Stock: ${v.stock ? 'Available' : 'Unavailable'}`;

        const bottom = document.createElement('div');
        bottom.style.display = 'flex';
        bottom.style.justifyContent = 'space-between';
        bottom.style.alignItems = 'center';

        const price = document.createElement('div');
        price.className = 'price';
        price.textContent = formatPrice(v.price);

        const badge = document.createElement('div');
        badge.className = 'badge';
        badge.textContent = v.stock ? 'In stock' : 'Sold / Hold';

        bottom.appendChild(price);
        bottom.appendChild(badge);

        meta.appendChild(title);
        meta.appendChild(specs);
        meta.appendChild(bottom);

        card.appendChild(thumb);
        card.appendChild(meta);

        inventoryEl.appendChild(card);
      }
    }

    function applyFilters() {
      const q = searchEl.value.trim().toLowerCase();
      const stock = filterStockEl.value;
      const sort = sortByEl.value;

      let items = (window.__inventoryData || sampleInventory).filter(v => {
        if (stock === 'in' && !v.stock) return false;
        if (stock === 'out' && v.stock) return false;
        if (!q) return true;
        return (`${v.make} ${v.model} ${v.year}`).toLowerCase().includes(q);
      });

      if (sort === 'priceLow') items.sort((a,b)=>a.price-b.price);
      else if (sort === 'priceHigh') items.sort((a,b)=>b.price-a.price);
      else items.sort((a,b)=>b.year-a.year);

      render(items);
    }

    searchEl.addEventListener('input', () => applyFilters());
    filterStockEl.addEventListener('change', () => applyFilters());
    sortByEl.addEventListener('change', () => applyFilters());

    async function loadInventory() {
      showLoading();
      try {
        const res = await fetch(API_URL, { cache: 'no-store' });
        if (!res.ok) throw new Error('Network response not ok');
        const data = await res.json();
        // Expecting an array; adjust if your GAS returns { items: [...] }
        const items = Array.isArray(data) ? data : (data.items || []);
        if (!items.length) throw new Error('No items returned');
        window.__inventoryData = items;
        render(items);
      } catch (err) {
        console.warn('Failed to load remote inventory, using sample:', err);
        showError('Failed to load remote inventory — showing local sample.');
        window.__inventoryData = sampleInventory;
        render(sampleInventory);
      }
    }

    // initial load from API (falls back to sample)
    loadInventory();
  </script>
</body>
</html>
